{"version":3,"sources":["../../../server/middlewares/verify/verify.js"],"names":["dotenv","config","secret","process","env","SECRET_KEY","apiKey","ApiKey","verifyAdmin","req","res","next","password","authData","bcrypt","compareSync","status","json","message","verifyAttendant","authVerify","authorization","headers","error","jwt","verify","err"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEAA,iBAAOC,MAAP;;AAEA,IAAMC,SAASC,QAAQC,GAAR,CAAYC,UAA3B;AACA,IAAMC,SAASH,QAAQC,GAAR,CAAYG,MAA3B;;AAEA,SAASC,WAAT,CAAqBC,GAArB,EAA0BC,GAA1B,EAA+BC,IAA/B,EAAqC;AAAA,MAC3BC,QAD2B,GACdH,IAAII,QADU,CAC3BD,QAD2B;;;AAGnC,MAAI,CAACE,mBAAOC,WAAP,CAAmBT,MAAnB,EAA2BM,QAA3B,CAAL,EAA2C;AACzC,WAAOF,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,SAAS,iCAAX,EAArB,CAAP;AACD;;AAED,SAAOP,MAAP;AACD;;AAED,SAASQ,eAAT,CAAyBV,GAAzB,EAA8BC,GAA9B,EAAmCC,IAAnC,EAAyC;AAAA,MAC/BC,QAD+B,GAClBH,IAAII,QADc,CAC/BD,QAD+B;;;AAGvC,MAAIE,mBAAOC,WAAP,CAAmBT,MAAnB,EAA2BM,QAA3B,CAAJ,EAA0C;AACxC,WAAOF,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,SAAS,4CAAX,EAArB,CAAP;AACD;;AAED,SAAOP,MAAP;AACD;;AAED,SAASS,UAAT,CAAoBX,GAApB,EAAyBC,GAAzB,EAA8BC,IAA9B,EAAoC;AAAA,MAC1BU,aAD0B,GACRZ,IAAIa,OADI,CAC1BD,aAD0B;;;AAGlC,MAAI,CAACA,aAAL,EAAoB;AAClB,WAAOX,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,eAAS,6BADiB;AAE1BK,aAAO;AAFmB,KAArB,CAAP;AAID;;AAEDC,yBAAIC,MAAJ,CAAWJ,aAAX,EAA0BnB,MAA1B,EAAkC,UAACwB,GAAD,EAAMb,QAAN,EAAmB;AACnD,QAAIa,GAAJ,EAAS;AACP,aAAOhB,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,iBAAS,sCADiB;AAE1BK,eAAO;AAFmB,OAArB,CAAP;AAID;AACDd,QAAII,QAAJ,GAAeA,QAAf;AACA,WAAOF,MAAP;AACD,GATD;AAUD;;kBAEc,EAAEH,wBAAF,EAAeW,gCAAf,EAAgCC,sBAAhC,E","file":"verify.js","sourcesContent":["import bcrypt from 'bcryptjs';\r\nimport jwt from 'jsonwebtoken';\r\nimport dotenv from 'dotenv';\r\n\r\ndotenv.config();\r\n\r\nconst secret = process.env.SECRET_KEY;\r\nconst apiKey = process.env.ApiKey;\r\n\r\nfunction verifyAdmin(req, res, next) {\r\n  const { password } = req.authData;\r\n\r\n  if (!bcrypt.compareSync(apiKey, password)) {\r\n    return res.status(401).json({ message: 'Sorry, accessible to admin only' });\r\n  }\r\n\r\n  return next();\r\n}\r\n\r\nfunction verifyAttendant(req, res, next) {\r\n  const { password } = req.authData;\r\n\r\n  if (bcrypt.compareSync(apiKey, password)) {\r\n    return res.status(401).json({ message: 'Sorry, accessible to store attendants only' });\r\n  }\r\n\r\n  return next();\r\n}\r\n\r\nfunction authVerify(req, res, next) {\r\n  const { authorization } = req.headers;\r\n\r\n  if (!authorization) {\r\n    return res.status(401).json({\r\n      message: 'Please, you have to sign in',\r\n      error: true,\r\n    });\r\n  }\r\n\r\n  jwt.verify(authorization, secret, (err, authData) => {\r\n    if (err) {\r\n      return res.status(401).json({\r\n        message: 'You must provide valid authorization',\r\n        error: true,\r\n      });\r\n    }\r\n    req.authData = authData;\r\n    return next();\r\n  });\r\n}\r\n\r\nexport default { verifyAdmin, verifyAttendant, authVerify };\r\n"]}
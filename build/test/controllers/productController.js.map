{"version":3,"sources":["../../../server/test/controllers/productController.js"],"names":["chai","use","chaiHttp","expect","admin","userData","attendant","exampleProduct","productData","adminToken","attendantToken","describe","before","done","request","app","post","send","end","err","res","body","token","it","get","set","to","equal","have","status","property","that","is","an","has","length","greaterThan","message","newProduct"],"mappings":"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","sourcesContent":["import chai from 'chai';\r\nimport chaiHttp from 'chai-http';\r\nimport app from '../../app';\r\nimport userData from './mocks/userData';\r\nimport productData from './mocks/productData';\r\n\r\nchai.use(chaiHttp);\r\nconst { expect } = chai;\r\n\r\nconst { admin, attendant } = userData;\r\nconst { exampleProduct } = productData;\r\n\r\nlet adminToken;\r\nlet attendantToken;\r\n\r\ndescribe('products', () => {\r\n  before((done) => {\r\n    chai.request(app)\r\n      .post('/api/v1/auth/login')\r\n      .send(admin)\r\n      .end((err, res) => {\r\n        adminToken = res.body.token;\r\n      });\r\n    chai.request(app)\r\n      .post('/api/v1/auth/login')\r\n      .send(attendant)\r\n      .end((err, res) => {\r\n        attendantToken = res.body.token;\r\n        done();\r\n      });\r\n  });\r\n\r\n  describe('get requests for products', () => {\r\n    it('Should return all products', (done) => {\r\n      chai.request(app)\r\n        .get('/api/v1/products')\r\n        .set('Authorization', adminToken)\r\n        .end((err, res) => {\r\n          expect(err).to.equal(null);\r\n          expect(res).to.have.status(200);\r\n          expect(res.body).to.have.property('allProducts').that.is.an('array').that.has.length.greaterThan(0);\r\n          done();\r\n        });\r\n    });\r\n\r\n    it('Should return all available products', (done) => {\r\n      chai.request(app)\r\n        .get('/api/v1/products/available')\r\n        .set('Authorization', adminToken)\r\n        .end((err, res) => {\r\n          expect(err).to.equal(null);\r\n          expect(res).to.have.status(200);\r\n          expect(res.body).to.have.property('availableProducts').that.is.an('array').that.has.length.greaterThan(0);\r\n          done();\r\n        });\r\n    });\r\n\r\n    it('Should return an existing product', (done) => {\r\n      chai.request(app)\r\n        .get('/api/v1/products/1')\r\n        .set('Authorization', attendantToken)\r\n        .end((err, res) => {\r\n          expect(err).to.equal(null);\r\n          expect(res).to.have.status(200);\r\n          expect(res.body).to.have.property('product').that.is.an('object').that.has.property('id');\r\n          done();\r\n        });\r\n    });\r\n\r\n    it('Should not return product for non-existent id', (done) => {\r\n      chai.request(app)\r\n        .get('/api/v1/products/20')\r\n        .set('Authorization', adminToken)\r\n        .end((err, res) => {\r\n          expect(res).to.have.status(404);\r\n          expect(res.body.message).to.equal('sorry, product does not exist');\r\n          done();\r\n        });\r\n    });\r\n  });\r\n\r\n  describe('post requests for products', () => {\r\n    it('attendants should not add products to the store', (done) => {\r\n      chai.request(app)\r\n        .post('/api/v1/products')\r\n        .set('Authorization', attendantToken)\r\n        .send(exampleProduct)\r\n        .end((err, res) => {\r\n          expect(res).to.have.status(401);\r\n          expect(res.body.message).to.equal('Sorry, accessible to admin only');\r\n          done();\r\n        });\r\n    });\r\n\r\n    it('admin should add products to the store', (done) => {\r\n      chai.request(app)\r\n        .post('/api/v1/products')\r\n        .set('Authorization', adminToken)\r\n        .send(exampleProduct)\r\n        .end((err, res) => {\r\n          expect(err).to.equal(null);\r\n          expect(res).to.have.status(201);\r\n          expect(res.body.newProduct).to.have.property('id');\r\n          done();\r\n        });\r\n    });\r\n  });\r\n});\r\n"],"file":"productController.js"}